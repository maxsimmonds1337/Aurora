<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aurora ü™ê</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="./CSS/styles.css">

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://unpkg.com/react/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/react/umd/react.production.min.js"></script>


    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/addons/p5.sound.min.js"></script> -->

    <script>

        let cal_open = false;

        function SendData() {

            event.preventDefault(); // Prevent the form from submitting in the normal way

            // get all the checkboxes
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:not(#send_colour)');

            // create an empty array to store the checked values
            const checkedValues = [];

            // loop through each checkbox
            checkboxes.forEach(function (checkbox) {
                // check if the checkbox is checked
                if (checkbox.checked) {
                    // add the checkbox value to the array of checked values
                    checkedValues.push(checkbox.value);
                }
            });

            var data;

            const breast_milk_time = parseInt(document.getElementById('breast_milk_mins').value);
            const breast_milk_mls = parseInt(document.getElementById('breast_milk_mls').value);
            const formula_milk_mls = parseInt(document.getElementById('formula_milk_mls').value);
            const send_colour = document.getElementById("send_colour").checked;
            const colour = document.getElementById("colour_box").value;
            const send_activites = checkedValues.length;
            const time_stamp = document.getElementById("date").value;

            data = {
                ...data,
                "baby_id": 1,
                "activities": send_activites ? checkedValues : undefined,
                "colour": send_colour ? colour : undefined,
                "breast_milk_time": breast_milk_time ? breast_milk_time : 0,
                "breast_milk_mls": breast_milk_mls ? breast_milk_mls : 0,
                "formula_milk_mls": formula_milk_mls ? formula_milk_mls : 0,
                "time": time_stamp,
            }

            fetch('/get_post_content', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data),
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Success');
                    location.reload();

                })
                .catch((error) => {
                    console.error('Error:', error);
                });

        }
    </script>
</head>

<body>

    <label class="switch">
        <input type="checkbox" id="lang_button">
        <div class="slider round"></div>
    </label>

    <form method="post" onsubmit="SendData()">
        <div id="Outputs">

            <h2 translation="en">
                Outputs:
            </h2>

            <label>
                <input type="checkbox" name="event" value="pooped">
                <label translation="en">Poo</label>
            </label>

            <label>
                <input type="checkbox" name="event" value="peed">
                <label translation="en">Wee</label>
            </label>

            <label>
                <input type="checkbox" name="event" value="had_blood">
                <label translation="en">Blood</label>
            </label>

            <label>
                <input type="checkbox" name="event" value="vomited">
                <label translation="en">Vomit</label>
            </label>
            <br>
            <label>
                <label translation="en">Colour</label>
                <input type="color" id="colour_box" value="#000000">
            </label>
            <br>
            <label>
                <label translation="en">Send Colour?</label><input type="checkbox" id="send_colour" value="send_colour">
            </label>
            <br>
            <label>
                <label translation="en">
                    Choose a date and time?
                </label>
            </label>
            <input type="text" id="date" name="date" onclick="cal_open=true">
        </div>

        <div id="inputs">
            <h2 translation="en">
                Inputs:
            </h2>

            <p>
                <label>
                    <label translation="en">Breast Milk :</label> <input type="number" id="breast_milk_mins" value="">
                    <label translation="en">minutes</label>
                </label>
                <br>
                <label>
                    <label translation="en">Breast Milk (expressed) :</label> <input type="number" id="breast_milk_mls"
                        value="">
                    <label translation="en">ml</label>
                </label>
                <br>
                <label>
                    <label translation="en">Formula Milk :</label><input type="number" id="formula_milk_mls" value="">
                    <label translation="en">ml</label>
                </label>

            </p>
        </div>

        <input type="submit" value="Submit">

    </form>

</body>

<script>

    let intervalId;
    let userChanged = false;

    const translations = {


        "en": {
            "–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:": "Outputs:",
            "–ö–∞–∫–∞—à–∫–∏": "Poo",
            "–ú–æ—á–∞": "Wee",
            "–ö—Ä–æ–≤—å": "Blood",
            "–†–≤–æ—Ç–∞": "Vomit",
            "–¶–≤–µ—Ç:": "Colour",
            "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ü–≤–µ—Ç?": "Send Colour?",
            "–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è": "Choose a date and time?",
            "–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:": "Inputs:",
            "–ì—Ä—É–¥–Ω–æ–µ –º–æ–ª–æ–∫–æ:": "Breast Milk :",
            "–ì—Ä—É–¥–Ω–æ–µ –º–æ–ª–æ–∫–æ (–≤—ã—Ä–∞–∂–µ–Ω–Ω–æ–µ):": "Breast Milk (expressed) :",
            "–§–æ—Ä–º—É–ª–∞ –º–æ–ª–æ–∫–∞:": "Formula Milk :",
            "–º–∏–Ω—É—Ç": "minutes",
            "–º–ª": "ml",
            "–û—Ç–ø—Ä–∞–≤–∏—Ç—å": "Submit"
        },
        "ru": {
            "Outputs:": "–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:",
            "Poo": "–ö–∞–∫–∞—à–∫–∏",
            "Wee": "–ú–æ—á–∞",
            "Blood": "–ö—Ä–æ–≤—å",
            "Vomit": "–†–≤–æ—Ç–∞",
            "Colour": "–¶–≤–µ—Ç:",
            "Send Colour?": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ü–≤–µ—Ç?",
            "Choose a date and time?": "–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è",
            "Inputs:": "–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:",
            "Breast Milk :": "–ì—Ä—É–¥–Ω–æ–µ –º–æ–ª–æ–∫–æ:",
            "Breast Milk (expressed) :": "–ì—Ä—É–¥–Ω–æ–µ –º–æ–ª–æ–∫–æ (–≤—ã—Ä–∞–∂–µ–Ω–Ω–æ–µ):",
            "Formula Milk :": "–§–æ—Ä–º—É–ª–∞ –º–æ–ª–æ–∫–∞:",
            "minutes": "–º–∏–Ω—É—Ç",
            "ml": "–º–ª",
            "Submit": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
        }
    }

    let slider = document.getElementById("lang_button");

    slider.addEventListener("change", function (event) {
        const lang = event.target.checked ? "ru" : "en";
        console.log(lang)
        const elements = document.querySelectorAll("[translation]")
        elements.forEach(function (element) {
            console.log(element)
            const key = element.innerHTML.trim();
            const text = translations[lang][key];
            console.log("key " + key + " text " + text);
            element.innerHTML = text;
        });
    });

    const fp = flatpickr("#date", {
        disableMobile: "true",
        enableTime: true,
        dateFormat: "Y-m-d H:i:s",
        defaultDate: new Date(),
        onOpen: function (selectedDates, dateStr, instance) {
            clearInterval(intervalId);
        },
        onClose: function (selectedDates, dateStr, instance) {
            if (!userChanged) {
                intervalId = setInterval(function () {
                    instance.setDate(new Date(), false);
                }, 1000);
            }
            userChanged = false;
        },
        onChange: function (selectedDates, dateStr, instance) {
            userChanged = true;
        }
    });

    intervalId = setInterval(function () {
        fp.setDate(new Date(), false);
    }, 1000);


</script>

</html>